#include <assert.h>

static void hello_cleanup(void *data)
{
    mln_log(debug, "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n");
}

int hello_main(int argc, char **argv)
{
  mln_set_cleanup(hello_cleanup, NULL);
  int i;
  for (i = 0; i < 100; i++)  {
    int fd = atoi(argv[argc-1]);
    mln_thread_msg_t msg;
    memset(&msg, 0, sizeof(msg));
    msg.dest = mln_new_string("haha");
    assert(msg.dest);
    msg.sauto = 9736;
    msg.c = 'N';
    msg.type = ITC_REQUEST;
    msg.need_clear = 0;
    int n = write(fd, &msg, sizeof(msg));
    if (n != sizeof(msg)) {
        mln_log(debug, "write error. n=%d. %s\n", n, strerror(errno));
        mln_free_string(msg.dest);
        return -1;
    }
  }
    return 0;
}

